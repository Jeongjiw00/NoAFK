<!DOCTYPE html>
<html lang="ko">
  <head>
    {% include "head.html" %}
    <title>noAFK | 회원관리</title>
    <link rel="stylesheet" href="css/admin.css" />
  </head>
  <body>
    <header id="hd">
      <div id="hd_top">
        <div id="logo">
          <a href="/adminUser">어드민 페이지</a>
        </div>

        <div id="tnb">
          <ul>
            <li class="tnb_li">
              <a href="/adminUser" class="tnb_service">회원관리</a>
            </li>
            <li class="tnb_li">
              <a href="/adminUser" class="tnb_service">공고관리</a>
            </li>
            <li class="tnb_li_logout">
              <a href="/adminUser" class="tnb_service">로그아웃</a>
            </li>
          </ul>
        </div>
      </div>
    </header>

    <div id="wrapper">
      <div id="container" class="container-small">
        <h1 id="container_title">회원관리</h1>
        <div class="container_wr">
          <div class="local_ov01 local_ov">
            <span class="btn_ov01"
              ><span class="ov_txt">총회원수 </span><span class="ov_num"></span
            ></span>
          </div>

          <form id="fsearch" class="local_sch01 local_sch">
            <select name="sfl" id="sfl">
              <option value="user_email">이메일</option>
              <option value="user_nick">닉네임</option>
            </select>
            <input
              type="text"
              name="stx"
              id="stx"
              placeholder="검색어를 입력하세요"
              required
              class="required frm_input"
            />
            <input type="submit" value="검색" class="btn_submit" />
          </form>

          <div class="tbl_head01 tbl_wrap">
            <table>
              <thead>
                <tr>
                  <th scope="col" class="user_list_id td_mng_s">회원번호</th>
                  <th scope="col" class="user_list_email">이메일</th>
                  <th scope="col" class="user_list_nickname">닉네임</th>
                  <th scope="col" class="user_list_introduction">자기소개</th>
                  <th scope="col" class="user_list_test_result">성격유형</th>
                  <th scope="col" class="user_list_expired_at">
                    멤버쉽 만료일
                  </th>
                  <th scope="col" class="user_list_auth_level" class="td_mng_s">
                    권한등급
                  </th>
                  <th scope="col" class="user_list_control td_mng_s">관리</th>
                </tr>
              </thead>
              <tbody id="usersList"></tbody>
            </table>
          </div>
          <nav aria-label="Page navigation">
            <ul
              class="pagination justify-content-center"
              id="pagination-wrap"
            ></ul>
          </nav>
        </div>
        <footer id="ft">
          <p>Copyright &copy; noAFK All rights reserved.<br /></p>
        </footer>
      </div>
    </div>
    <<<<<<< HEAD
    <script src="js/adminUser.js"></script>
    =======
    <script>
      (async function () {
        await getUserList();
      })();

      function getUserList() {
        fetch('/users')
          .then(function (response) {
            return response.json();
          })
          .then(function (res) {
            document.querySelector('.ov_num').textContent = res.length;
            for (let i = 0; i < res.length; i++) {
              const fd = res[i];
              const { test_result, expired_at } = fd;
              const isTestNotComplete = test_result === 0;
              const isExpired = expired_at !== null;
              if (isTestNotComplete) {
                fd.test_result = '미완료';
                if (!isExpired) {
                  fd.expired_at = '미완료';
                }
              } else if (!isExpired) {
                fd.expired_at = '미완료';
              }
              appendTempHtml({ ...fd });
            }
          });
      }

      function appendTempHtml({ ...fd }) {
        let temp_html = `<tr class="block${fd.auth_level}">
                          <td headers="user_list_id" class="user_id">${fd.id}</td>
                          <td headers="user_list_email" class="user_email">${fd.email}</td>
                          <td headers="user_list_nickname" class="user_nickname">
                            ${fd.nickname}
                          </td>
                          <td
                            headers="user_list_introduction"
                            class="user_introduction"
                          >
                          ${fd.introduction}
                          </td>
                          <td
                            headers="user_list_test_result"
                            class="user_test_result"
                          >
                          ${fd.test_result}
                          </td>
                          <td headers="user_list_expired_at" class="user_expired_at">
                            ${fd.expired_at}
                          </td>
                          <td headers="user_list_auth_level" class="user_auth_level">
                            ${fd.auth_level}
                          </td>
                          <td headers="user_list_control" class="user_control">
                            <a class="btn btn_03" onclick="blockUser(${fd.id})">차단</a>
                            <a class="btn btn_02" onclick="deleteUser(${fd.id})">삭제</a>
                          </td>
                        </tr>`;
        document.getElementById('usersList').innerHTML += temp_html;
      }

      function blockUser(id) {
        fetch(`/users/${id}`, {
          method: 'PATCH',
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            location.reload();
          });
      }

      function deleteUser(id) {
        fetch(`/users/${id}`, {
          method: 'DELETE',
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            location.reload();
          });
      }
    </script>
    >>>>>>> 6dff0a9 ([수정] ajax => fetch 로 변경)
  </body>
</html>
